' Gambas class file

Private $EventDate As String
Private $RegistNumber As String
Private $RegistType As String
Private $PatName As String
Private $PatAge As Integer
Private $PatSex As String
Private $PatEthnic As String
Private $PatContact As String
Private $PatDistrict As String
Private $PatMunicipal As String
Private $PatWardNum As Integer
Private $PatCovidSusp As Boolean
Private $PatCovidResult As String
Private $PatDiagnoText As String
Private $PatDiagnoState As String
Private $PatDiagnoOther As String
Private $LabMethod As String
Private $LabResult As String
Private $LabPlace As String
Private $PatOutcome As String
Private $PatReferLocat As String

Private $DHUser As String
Private $DHPass As String
Private $DHURL As String
Private $DHLocation As String
Private $DHQuote As String
Private $DHAgent As String
Private $DHCaCert As String
Private $DHOutput As String

Private $sSerial As Long
Private $sTest As String
Private $sYear As String

Private $tblpatbilling As String
Private $tblpatlabtest As String
Private $tblpatlabsubtest As String

Public Sub _new(sSerial As Long, sTest As String, sYear As String)

  $sSerial = sSerial
  $sTest = sTest
  $sYear = sYear

  $DHUser = Trim(UnBase64(modSettings.ShowSettingFromFIle("EWARS/UserName")))
  $DHPass = Trim(UnBase64(modSettings.ShowSettingFromFIle("EWARS/Password")))
  $DHURL = Trim(modSettings.ShowSettingFromFIle("EWARS/URL"))
  $DHLocation = Trim(modSettings.ShowSettingFromFIle("EWARS/Location"))
  $DHAgent = Trim(modSettings.ShowSettingFromFIle("EWARS/UserAgent"))
  $DHQuote = Trim(modSettings.ShowSettingFromFIle("EWARS/QuotePass"))
  $DHCaCert = Trim(modSettings.ShowSettingFromFIle("EWARS/CACertificate"))
  $DHOutput = ""
  LoadTableNames()
  ExecuteAPI()

  ' $DHUser = "sankhuwasabha.hosp"
  ' $DHPass = "Ewars@2019"
  ' $DHURL = "http://ewars.edcd.gov.np/ewarsdemo/api/events"
  ' $DHLocation = "WLBxL2ClHIC"

End

Private Sub LoadTableNames()

  Dim res As Result

  If $sYear = "Current" Then
    $tblpatbilling = "tblpatbilling"
    $tblpatlabtest = "tblpatlabtest"
    $tblpatlabsubtest = "tblpatlabsubtest"
  Else
    res = modDatabase.$syConn.Exec("select fldpatbilling,fldpatlabtest,fldpatlabsubtest from tblfisclosing where fldindex=&1 and (fldstate=&2 or fldstate IS NULL)", $sYear, "Active")
    If res.Available Then
      If res["fldpatbilling"] Then
        $tblpatbilling = res["fldpatbilling"]
      Else
        $tblpatbilling = "tblpatbilling"
      Endif
      If res["fldpatlabtest"] Then
        $tblpatlabtest = res["fldpatlabtest"]
      Else
        $tblpatlabtest = "tblpatlabtest"
      Endif
      If res["fldpatlabsubtest"] Then
        $tblpatlabsubtest = res["fldpatlabsubtest"]
      Else
        $tblpatlabsubtest = "tblpatlabsubtest"
      Endif
    Else
      $tblpatbilling = "tblpatbilling"
      $tblpatlabtest = "tblpatlabtest"
      $tblpatlabsubtest = "tblpatlabsubtest"
    Endif
  Endif

End

Private Sub ExecuteAPI()

End

Public Function EWARSOutput() As String

  Return $DHOutput

End

Private Function GetEWARSJson() As Collection

End
