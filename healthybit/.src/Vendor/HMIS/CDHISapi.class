' Gambas class file

Private $DHUser As String
Private $DHPass As String
Private $DHURL As String
Private $DHLocation As String
Private $DHQuote As String
Private $DHAgent As String
Private $DHCaCert As String
Private $DHOutput As String

Private $xColl As Collection
Private $xDate As String
Private $xAttr As String

Public Sub _new(xVar As Variant[], xDate As String, Optional xAttr As String)

  Dim xVarData As Variant[]
  Dim xDateRange As String
  Dim asx As String[]

  xVarData = xVar
  xDateRange = xDate
  If xAttr Then
    $xAttr = xAttr
  Else
    $xAttr = ""
  Endif

  $DHUser = Trim(UnBase64(modSettings.ShowSettingFromFIle("DHIS2/UserName")))
  $DHPass = Trim(UnBase64(modSettings.ShowSettingFromFIle("DHIS2/Password")))
  $DHURL = Trim(modSettings.ShowSettingFromFIle("DHIS2/URL"))
  $DHLocation = Trim(modSettings.ShowSettingFromFIle("DHIS2/Location"))
  $DHAgent = Trim(modSettings.ShowSettingFromFIle("DHIS2/UserAgent"))
  $DHQuote = Trim(modSettings.ShowSettingFromFIle("DHIS2/QuotePass"))
  $DHCaCert = Trim(modSettings.ShowSettingFromFIle("DHIS2/CACertificate"))
  $DHOutput = ""

  asx = Split(xDateRange, "/")
  $xDate = asx[0] & asx[1]

  $xColl = New Collection
  $xColl.Add(xVarData, "dataValues")
  $xColl.Add($xDate, "period")
  $xColl.Add(Trim($DHLocation), "orgUnit")
  If $xAttr Then
    $xColl.Add($xAttr, "attributeOptionCombo")
  Endif

  ExecuteAPI()

End

Private Sub ExecuteAPI()

End

Public Function GetAPIOutput() As String

  Dim aColl As Collection
  Dim xmsg As String

  If $DHOutput Then
    Try aColl = JSON.Decode($DHOutput)
    If aColl["status"] = "SUCCESS" Then
      xmsg = "SUCCESS"
    Else
      xmsg = $DHOutput
    Endif
  Else
    xmsg = $DHOutput
  Endif
  Return xmsg

End
