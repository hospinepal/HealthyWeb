' Gambas class file

Private $sFIle As String
Private $encid As String

Public Sub _new(sPath As String, encid As String)

  $sFIle = sPath
  $encid = encid

End

Public Sub Form_Open()

  modGeneralMain.ArrangeFormCentre(Me, "False")
  btnfile.Text = File.Name($sFIle)
  If $encid Then
    rbarchive.Value = True
  Else
    rbarchive.Enabled = False
    rbpersonal.Value = True
  Endif
  txtdetail.SetFocus

End

Public Sub btnfile_Click()

  Desktop.Open($sFIle)

End

Public Sub btnsend_Click()

  If rbpersonal.Value = True Then
    SaveToPersonal()
  Else If rbarchive.Value = True Then
    SaveToArchive()
  Endif

End

Private Sub SaveToPersonal()

  If txtdetail.Text Then
    modImage.SaveDocumentToPersonal(modBasic.$lbluser, txtdetail.Text, $sFIle)
    Me.Close
  Endif

End

Private Sub SaveToArchive()

  Dim sLongID As Long

  Inc Application.Busy
  sLongID = modImage.SavePatientFileGeneral($encid, "General Reports", txtdetail.Text, $sFIle, False, modReportVar.$ReportHash)                       ''
  Dec Application.Busy
  Me.Close

End
